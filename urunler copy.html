<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SGTEK – Ürünler</title>
  <meta name="description" content="DMO onaylı ürünler kataloğu">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/urunler.css">
</head>
<body>
  <!-- HEADER (index ile aynı) -->
  <header class="header">
    <div class="container header__inner">
      <a class="brand" href="index.html" aria-label="SGTEK Ana Sayfa">
        <img src="img/sgtlogo.png" alt="SGTEK logo">
      </a>
      <nav class="nav" aria-label="Ana menü">
        <a href="index.html">Ana Sayfa</a>
        <a href="Kurumsal">Kurumsal</a>
        <a href="Siber Güvenlik">Siber Güvenlik</a>
        <a href="urunler.html" aria-current="page">Ürünler</a>
        <a href="#iletisim" onclick="document.getElementById('footer-contact').scrollIntoView({behavior:'smooth'});return false;">İletişim</a>
      </nav>
    </div>
  </header>

  <!-- MAIN (sadece arama + ürün grid) -->
  <main class="section">
    <div class="container">
      <h1 class="pg-title">Product Gallery</h1>

      <div class="searchbar">
        <input id="searchInput" type="search" placeholder="Ürün adı veya marka ara..." aria-label="Ürün ara">
      </div>

      <div id="productGrid" class="product-grid" aria-live="polite"></div>
      <div id="productEmpty" class="product-empty" hidden>Ürün bulunamadı.</div>
    </div>
  </main>

  <!-- FOOTER (index ile aynı) -->
  <footer class="footer" id="footer-contact">
    <div class="container footer__inner">
      <p>© <span id="yil"></span> SGTEK Tüm Hakları Saklıdır</p>
      <nav class="footer__nav">
        <a href="#Çerezler">Çerezler</a>
        <a href="#">KVKK</a>
        <a href="#">Gizlilik</a>
        <a href="#">Kullanım Şartları</a>
      </nav>
    </div>
  </footer>

<script>
  document.getElementById('yil').textContent = new Date().getFullYear();

  // ===== Google Sheets Kaynağı =====
  // https://docs.google.com/spreadsheets/d/1RtHLgzmaAsjNfQM79b5jy4kkaRbPFdMznbO3kktr3Ng/edit?usp=sharing
  const SHEET_ID   = "1RtHLgzmaAsjNfQM79b5jy4kkaRbPFdMznbO3kktr3Ng";
  const SHEET_NAME = "Sayfa1"; // sekme adını gerçek ada göre değiştir
  const GVIZ_URL   = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;

  // Kolon başlıkları (esnek)
  const headerMap = {
    title: ["ürün başlığı","urun basligi","ürün","product","title"],
    brand: ["marka","brand"],
    photo: ["foto url","görsel url","resim url","image","photo"],
    dmo:   ["dmo linki","dmo","dmo url"]
  };

  function findHeaderIndex(cols, aliases){
    for (let i=0;i<cols.length;i++){
      const label=(cols[i].label||"").toString().trim().toLowerCase();
      if (aliases.some(a => label===a || label.includes(a))) return i;
    }
    return -1;
  }

  async function fetchProducts(){
    const resp = await fetch(GVIZ_URL);
    const text = await resp.text();
    const json = JSON.parse(text.replace(/^[^{]+/,'').replace(/;?\s*$/,''));
    const cols = json.table.cols;
    const rows = json.table.rows;

    const idxTitle = findHeaderIndex(cols, headerMap.title);
    const idxBrand = findHeaderIndex(cols, headerMap.brand);
    const idxPhoto = findHeaderIndex(cols, headerMap.photo);
    const idxDmo   = findHeaderIndex(cols, headerMap.dmo);

    const items = [];
    for (const r of rows){
      const c = r.c || [];
      const title = (c[idxTitle]?.v || "").toString().trim();
      if (!title) continue; // sadece başlığı olan satırlar
      const brand = (idxBrand>=0 ? (c[idxBrand]?.v || "") : "").toString().trim();
      const photo = (idxPhoto>=0 ? (c[idxPhoto]?.v || "") : "").toString().trim();
      const dmo   = (idxDmo>=0   ? (c[idxDmo]?.v   || "") : "").toString().trim();
      items.push({title, brand, photo, dmo});
    }
    return items;
  }

  function renderProducts(items){
    const grid = document.getElementById("productGrid");
    const empty = document.getElementById("productEmpty");
    grid.innerHTML = "";

    if (!items.length){ empty.hidden=false; return; }
    empty.hidden = true;

    const frag = document.createDocumentFragment();
    for (const it of items){
      const card = document.createElement("article");
      card.className = "product-card";

      const imgWrap = document.createElement("div");
      imgWrap.className = "imgwrap";
      if (it.photo){
        const img = document.createElement("img");
        img.src = it.photo;
        img.alt = it.title;
        img.loading = "lazy";
        imgWrap.appendChild(img);
      } else {
        imgWrap.classList.add("noimg");
        imgWrap.textContent = "No Image";
      }
      card.appendChild(imgWrap);

      const title = document.createElement("h3");
      title.textContent = it.title;
      card.appendChild(title);

      if (it.brand){
        const brand = document.createElement("p");
        brand.className = "brand";
        brand.innerHTML = `<strong>Brand:</strong> ${it.brand.toUpperCase()}`;
        card.appendChild(brand);
      }

      if (it.dmo){
        const btn = document.createElement("a");
        btn.href = it.dmo;
        btn.target = "_blank";
        btn.rel = "noopener";
        btn.className = "btn btn--dmo";
        btn.textContent = "DMO’ya Git";
        card.appendChild(btn);
      }

      frag.appendChild(card);
    }
    grid.appendChild(frag);
  }

  // Basit canlı arama (başlık + marka)
  function wireSearch(items){
    const input = document.getElementById("searchInput");
    input.addEventListener("input", () => {
      const q = input.value.trim().toLowerCase();
      const filtered = !q ? items : items.filter(it =>
        it.title.toLowerCase().includes(q) ||
        (it.brand || "").toLowerCase().includes(q)
      );
      renderProducts(filtered);
    });
  }

  (async function init(){
    try{
      // Arama inputu var; kullanıcı yazdıkça filtreleyeceğiz
      const items = await fetchProducts();
      renderProducts(items);
      wireSearch(items);
    }catch(e){
      document.getElementById("productEmpty").hidden = false;
    }
  })();
</script>
</body>
</html>
